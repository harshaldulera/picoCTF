import requests
import base64

# Initialize a session
s = requests.Session()

# Get the initial response to retrieve the cookie
response = s.get('http://mercury.picoctf.net:34962/')
cookie = s.cookies['auth_name']
print("Original Cookie:", cookie)

# Decode the cookie twice
unb64 = base64.b64decode(cookie)
unb64 = base64.b64decode(unb64)

# Iterate over possible positions and bits to flip
for i in range(0, 128):
    pos = i // 8
    guessdec = unb64[:pos] + bytes([unb64[pos] ^ (1 << (i % 8))]) + unb64[pos + 1:]
    guessenc = base64.b64encode(guessdec)
    guess = base64.b64encode(guessenc).decode('utf-8')  # Decode to string

    # Send the manipulated cookie in a GET request
    r = requests.get('http://mercury.picoctf.net:34962/', cookies={'auth_name': guess})

    # Check if the response contains the flag
    if "pico" in r.text:
        print("Flag found:", r.text)
        break
